"use strict";var _options=null,trim=function(n){return n.replace(/^\s+/,"").replace(/\s+$/,"")},fs=require("fs"),path=require("path"),readLine=require("readline"),chalk=require("chalk"),files=null,filePath=null,contents=null,timer=null;function mkdirs(t,e){fs.exists(t,function(n){n?e():mkdirs(path.dirname(t),function(){fs.mkdir(t,e)})})}var writeFile=function(n){timer=setTimeout(function(){clearTimeout(timer),mkdirs(path.dirname(_options.output),function(){fs.writeFileSync(_options.output,n,function(n){if(n)throw n})})},30),console.log(chalk.bgGreen(chalk.black(" DONE "))+chalk.green(" Compiled successfully i18n!"))},findFiles=function c(l,f){if(0===f&&console.log("\u8bed\u8a00\u5f00\u59cb\u7f16\u8bd1..."),f===l.length)return contents=(contents=trim(contents)).substr(0,contents.length-1),void writeFile(contents+="\n  }\n}\nexport default i18n\n");var a=l[f],u=path.join(filePath,a);fs.stat(u,function(n,t){if(n)console.warn("\u83b7\u53d6\u6587\u4ef6stats\u5931\u8d25");else if(t.isFile()){var e=readLine.createInterface({input:fs.createReadStream(u)}),i=0,o=0,s=0,r=a.replace(/\.\w+/,"");if(".DS_Store"===l[f])return void c(l,++f);contents+="    ".concat(r,": {\n"),e.on("line",function(n){n&&0<=n.indexOf("'zh-CN': {")&&(i=s),n&&0<=n.indexOf("'zh-TW': {")&&(o=s),0<i&&i<s&&0===o&&n&&0!==n.length&&(contents+="  ".concat(n,"\r")),s++}),e.on("close",function(){console.log("\u7f16\u8bd1\u4e2d: ".concat(chalk.red(l[f]))),c(l,++f)})}else c(l,f+=1)})},travel=function e(i,o){fs.readdirSync(i).forEach(function(n){var t=path.join(i,n);fs.statSync(t).isDirectory()?e(t,o):o(t)})},modifyList=[];function MergeI18n(n){if(filePath=(_options=n).entry,n.clear)try{fs.unlinkSync(n.output)}catch(n){}}MergeI18n.prototype.apply=function(n){n.plugin("done",function(){files=fs.readdirSync(filePath),contents="const i18n = {\n  zh_CN: {\n",modifyList=[],fs.access(_options.output,function(n){n?findFiles(files,0):(travel(_options.entry,function(n){fs.stat(n,function(n,t){modifyList.push(t.mtimeMs)})}),fs.stat(_options.output,function(n,t){t.mtimeMs<Math.max.apply(null,modifyList)&&findFiles(files,0)}))})})},module.exports=MergeI18n;